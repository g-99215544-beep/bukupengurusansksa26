<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Buku Pengurusan Digital SK Sri Aman 2026">
    <meta name="theme-color" content="#6366f1">
    <title>Buku Pengurusan Digital - SK Sri Aman</title>
    
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f5f9;
            overflow-x: hidden;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pdf-page {
            background: white;
            margin: 0 auto 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .pdf-page canvas {
            display: block;
            width: 100%;
            height: auto;
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }
        
        .overlay.show {
            display: block;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
        }
        
        .tab-button.active {
            background: white;
            color: #667eea;
        }
        
        .nav-button {
            position: fixed;
            bottom: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s;
        }
        
        .nav-button:active {
            transform: scale(0.95);
        }
        
        .nav-button.prev {
            left: 20px;
        }
        
        .nav-button.next {
            right: 20px;
        }
        
        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .page-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .guru-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .guru-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .calendar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .calendar-day:hover {
            background: #f1f5f9;
        }
        
        .calendar-day.has-event {
            background: #e0e7ff;
        }
        
        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            bottom: 4px;
        }
        
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 8px;
        }
        
        .search-result {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            transition: background 0.2s;
        }
        
        .search-result:hover {
            background: #f8fafc;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .spinner {
            border: 3px solid #f1f5f9;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 640px) {
            .pdf-page {
                margin: 0 auto 12px;
            }
            
            .nav-button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .page-indicator {
                bottom: 20px;
                font-size: 14px;
                padding: 8px 16px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            schoolName: "SK Sri Aman",
            year: "2026",
            pdfFile: "buku-pengurusan.pdf",
            totalPages: 70,
            emoji: "üè´"
        };
        
        // ==================== TABLE OF CONTENTS ====================
        const TOC = [
            { id: 1, title: "Biodata Diri", page: 2, icon: "üìã" },
            { id: 2, title: "Kata Aluan Guru Besar", page: 3, icon: "üëã" },
            { id: 3, title: "Laman Sesawang", page: 4, icon: "üåê" },
            { id: 4, title: "Sejarah Sekolah", page: 5, icon: "üìú" },
            { id: 5, title: "Profil Sekolah", page: 6, icon: "üè¢" },
            { id: 6, title: "Pelan Kecemasan", page: 7, icon: "üö®" },
            { id: 7, title: "Senarai Guru dan Staf 2026", page: 8, icon: "üë•" },
            { id: 8, title: "Visi Dan Misi", page: 9, icon: "üéØ" },
            { id: 9, title: "Piagam Dan Lagu Sekolah", page: 10, icon: "üéµ" },
            { id: 10, title: "Jadual Guru Bertugas Mingguan", page: 11, icon: "üìÖ" },
            { id: 11, title: "Takwim", page: 19, icon: "üìÜ" },
            { id: 12, title: "Pengurusan Pentadbiran 2026", page: 25, icon: "‚ö°" },
            { id: 13, title: "Pengurusan Kurikulum 2026", page: 34, icon: "üìö" },
            { id: 14, title: "Pengurusan Hal Ehwal Murid 2026", page: 49, icon: "üíô" },
            { id: 15, title: "Pengurusan Kokurikulum 2026", page: 57, icon: "üéØ" }
        ];
        
        // ==================== GURU DATABASE ====================
        const TEACHERS = [
            { id: 1, name: "MAHATHIR BIN MD SAHAK", position: "Guru Besar", avatar: "üë®‚Äçüíº", page: 25 },
            { id: 2, name: "MUHAIZAM BIN MD MOKHTAR", position: "PK Pentadbiran", avatar: "üë®‚Äçüíº", page: 25 },
            { id: 3, name: "SHARIMAH BINTI MD ZIN", position: "PK HEM", avatar: "üë©‚Äçüíº", page: 49 },
            { id: 4, name: "SANGARA NANDA A/P KARUPPIAH", position: "PK Kokurikulum", avatar: "üë©‚Äçüíº", page: 57 },
            { id: 5, name: "MUHAMMAD SUFIAN B MUSTAFA BAKRI", position: "Guru Matematik", avatar: "üë®‚Äçüè´", page: 34 },
        ];
        
        // ==================== CALENDAR EVENTS ====================
        const EVENTS = {
            "2026-01-01": [{ name: "Cuti Akhir Sesi 2025/2026", type: "holiday", color: "#ef4444" }],
            "2026-01-08": [{ name: "Hari Orientasi", type: "school", color: "#10b981" }],
            "2026-02-02": [{ name: "Cuti Thaipusam", type: "holiday", color: "#ef4444" }],
            "2026-05-01": [{ name: "Cuti Hari Pekerja", type: "holiday", color: "#ef4444" }],
        };
        
        // ==================== MAIN APP ====================
        function App() {
            const [activeTab, setActiveTab] = useState('buku');
            const [currentPage, setCurrentPage] = useState(1);
            const [pdfDoc, setPdfDoc] = useState(null);
            const [loading, setLoading] = useState(true);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [showSearch, setShowSearch] = useState(false);
            
            // Load PDF
            useEffect(() => {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 
                    'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                
                pdfjsLib.getDocument(CONFIG.pdfFile).promise.then(pdf => {
                    setPdfDoc(pdf);
                    setLoading(false);
                });
            }, []);
            
            // Search
            useEffect(() => {
                if (searchQuery.length < 2) {
                    setSearchResults([]);
                    setShowSearch(false);
                    return;
                }
                
                const results = [];
                const query = searchQuery.toLowerCase();
                
                // Search TOC
                TOC.forEach(item => {
                    if (item.title.toLowerCase().includes(query)) {
                        results.push({ type: 'toc', data: item });
                    }
                });
                
                // Search Teachers
                TEACHERS.forEach(teacher => {
                    if (teacher.name.toLowerCase().includes(query) || 
                        teacher.position.toLowerCase().includes(query)) {
                        results.push({ type: 'teacher', data: teacher });
                    }
                });
                
                setSearchResults(results.slice(0, 10));
                setShowSearch(results.length > 0);
            }, [searchQuery]);
            
            const handleSearchClick = (result) => {
                if (result.type === 'toc' || result.type === 'teacher') {
                    setActiveTab('buku');
                    setCurrentPage(result.data.page);
                }
                setSearchQuery('');
                setShowSearch(false);
            };
            
            return (
                <div>
                    {/* Header */}
                    <header className="gradient-bg text-white p-4 sticky top-0 z-50 shadow-lg">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex items-center gap-3 mb-3">
                                <button 
                                    onClick={() => setSidebarOpen(true)}
                                    className="text-3xl"
                                >
                                    ‚ò∞
                                </button>
                                <div className="flex-1">
                                    <h1 className="text-xl font-bold">{CONFIG.emoji} {CONFIG.schoolName}</h1>
                                    <p className="text-sm opacity-90">Buku Pengurusan {CONFIG.year}</p>
                                </div>
                            </div>
                            
                            {/* Search */}
                            <div className="relative mb-3">
                                <input
                                    type="text"
                                    placeholder="üîç Cari..."
                                    className="w-full px-4 py-2 rounded-lg text-gray-800"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                />
                                {showSearch && (
                                    <div className="search-dropdown">
                                        {searchResults.map((result, idx) => (
                                            <div
                                                key={idx}
                                                className="search-result"
                                                onClick={() => handleSearchClick(result)}
                                            >
                                                <div className="font-semibold">
                                                    {result.type === 'toc' ? result.data.icon : result.data.avatar} {' '}
                                                    {result.data.title || result.data.name}
                                                </div>
                                                <div className="text-sm text-gray-600">
                                                    {result.data.position || `Muka surat ${result.data.page}`}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            
                            {/* Tabs */}
                            <div className="flex gap-2">
                                <button
                                    className={`tab-button ${activeTab === 'buku' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('buku')}
                                >
                                    üìñ Buku
                                </button>
                                <button
                                    className={`tab-button ${activeTab === 'guru' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('guru')}
                                >
                                    üë• Guru
                                </button>
                                <button
                                    className={`tab-button ${activeTab === 'takwim' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('takwim')}
                                >
                                    üìÖ Takwim
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    {/* Sidebar */}
                    <div className={`sidebar ${sidebarOpen ? 'open' : ''}`}>
                        <div className="p-4">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-lg">Kandungan</h3>
                                <button
                                    onClick={() => setSidebarOpen(false)}
                                    className="text-2xl"
                                >
                                    ‚úï
                                </button>
                            </div>
                            {TOC.map(item => (
                                <div
                                    key={item.id}
                                    className="p-3 hover:bg-gray-100 rounded cursor-pointer mb-2"
                                    onClick={() => {
                                        setActiveTab('buku');
                                        setCurrentPage(item.page);
                                        setSidebarOpen(false);
                                    }}
                                >
                                    <div className="font-semibold">{item.icon} {item.title}</div>
                                    <div className="text-sm text-gray-600">Muka surat {item.page}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    {/* Overlay */}
                    <div 
                        className={`overlay ${sidebarOpen ? 'show' : ''}`}
                        onClick={() => setSidebarOpen(false)}
                    />
                    
                    {/* Content */}
                    <main className="max-w-4xl mx-auto p-4 pb-32">
                        {activeTab === 'buku' && (
                            <PDFViewer 
                                pdfDoc={pdfDoc}
                                currentPage={currentPage}
                                setCurrentPage={setCurrentPage}
                                loading={loading}
                            />
                        )}
                        
                        {activeTab === 'guru' && <GuruTab teachers={TEACHERS} setActiveTab={setActiveTab} setCurrentPage={setCurrentPage} />}
                        {activeTab === 'takwim' && <TakwimTab events={EVENTS} />}
                    </main>
                </div>
            );
        }
        
        // ==================== PDF VIEWER ====================
        function PDFViewer({ pdfDoc, currentPage, setCurrentPage, loading }) {
            const containerRef = useRef(null);
            const [rendering, setRendering] = useState(false);
            
            useEffect(() => {
                if (!pdfDoc || !containerRef.current) return;
                
                const renderPage = async () => {
                    setRendering(true);
                    const container = containerRef.current;
                    container.innerHTML = '';
                    
                    try {
                        const page = await pdfDoc.getPage(currentPage);
                        const viewport = page.getViewport({ scale: 1.5 });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        const pageDiv = document.createElement('div');
                        pageDiv.className = 'pdf-page';
                        pageDiv.appendChild(canvas);
                        container.appendChild(pageDiv);
                        
                        await page.render({ canvasContext: context, viewport }).promise;
                    } catch (error) {
                        console.error('Error rendering:', error);
                    } finally {
                        setRendering(false);
                    }
                };
                
                renderPage();
            }, [pdfDoc, currentPage]);
            
            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>Memuatkan PDF...</p>
                    </div>
                );
            }
            
            return (
                <div>
                    <div ref={containerRef}></div>
                    
                    {/* Navigation Buttons */}
                    <button
                        className="nav-button prev"
                        onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                        disabled={currentPage === 1}
                    >
                        ‚Üê
                    </button>
                    
                    <div className="page-indicator">
                        {currentPage} / {CONFIG.totalPages}
                    </div>
                    
                    <button
                        className="nav-button next"
                        onClick={() => setCurrentPage(Math.min(CONFIG.totalPages, currentPage + 1))}
                        disabled={currentPage === CONFIG.totalPages}
                    >
                        ‚Üí
                    </button>
                </div>
            );
        }
        
        // ==================== GURU TAB ====================
        function GuruTab({ teachers, setActiveTab, setCurrentPage }) {
            return (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Direktori Guru</h2>
                    {teachers.map(teacher => (
                        <div
                            key={teacher.id}
                            className="guru-card"
                            onClick={() => {
                                setActiveTab('buku');
                                setCurrentPage(teacher.page);
                            }}
                        >
                            <div className="flex items-center gap-4">
                                <div className="text-4xl">{teacher.avatar}</div>
                                <div>
                                    <h3 className="font-bold text-lg">{teacher.name}</h3>
                                    <p className="text-gray-600">{teacher.position}</p>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }
        
        // ==================== TAKWIM TAB ====================
        function TakwimTab({ events }) {
            const [currentMonth, setCurrentMonth] = useState(new Date());
            
            const monthNames = [
                'Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun',
                'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'
            ];
            
            const daysInMonth = new Date(
                currentMonth.getFullYear(),
                currentMonth.getMonth() + 1,
                0
            ).getDate();
            
            const firstDay = new Date(
                currentMonth.getFullYear(),
                currentMonth.getMonth(),
                1
            ).getDay();
            
            const days = [];
            for (let i = 0; i < firstDay; i++) {
                days.push(null);
            }
            for (let i = 1; i <= daysInMonth; i++) {
                days.push(i);
            }
            
            const getEventsForDate = (day) => {
                if (!day) return [];
                const dateStr = `${currentMonth.getFullYear()}-${String(currentMonth.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                return events[dateStr] || [];
            };
            
            return (
                <div className="calendar">
                    <div className="flex justify-between items-center mb-4">
                        <button
                            onClick={() => setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth() - 1)))}
                            className="px-4 py-2 bg-indigo-600 text-white rounded"
                        >
                            ‚Üê
                        </button>
                        <h2 className="text-xl font-bold">
                            {monthNames[currentMonth.getMonth()]} {currentMonth.getFullYear()}
                        </h2>
                        <button
                            onClick={() => setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth() + 1)))}
                            className="px-4 py-2 bg-indigo-600 text-white rounded"
                        >
                            ‚Üí
                        </button>
                    </div>
                    
                    <div className="calendar-grid">
                        {['Ahd', 'Isn', 'Sel', 'Rab', 'Kha', 'Jum', 'Sab'].map(day => (
                            <div key={day} className="text-center font-bold text-sm p-2">
                                {day}
                            </div>
                        ))}
                        
                        {days.map((day, idx) => {
                            const dayEvents = getEventsForDate(day);
                            return (
                                <div
                                    key={idx}
                                    className={`calendar-day ${dayEvents.length > 0 ? 'has-event' : ''}`}
                                >
                                    {day && (
                                        <>
                                            <span className="font-semibold">{day}</span>
                                            {dayEvents.map((event, i) => (
                                                <div
                                                    key={i}
                                                    className="event-dot"
                                                    style={{ backgroundColor: event.color, left: `${20 + i * 10}px` }}
                                                    title={event.name}
                                                />
                                            ))}
                                        </>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }
        
        // ==================== RENDER ====================
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
    
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
